# ë‚ ì§œ : 2022-10-18 07:40

# ì£¼ì œ : #java #code_manipulation
----
# ë©”ëª¨

```toc
```

```ad-note
title: tl;dr
- 
```


## 1. ìš©ì–´ ì •ë¦¬ 
![](../img/IMG_9BB70C6FE328-1.jpeg)
### JVM (Java Virtual Machine)
ìë°” ê°€ìƒ ë¨¸ì‹ ìœ¼ë¡œ, ìë°” `ë°”ì´íŠ¸ ì½”ë“œ(.class)`ë¥¼ ì–´ë–»ê²Œ ì‹¤í–‰í• ì§€ì— ëŒ€í•œ í‘œì¤€ ìŠ¤íŒ©ì´ë‹¤.
-  **ìë°” ë°”ì´íŠ¸ ì½”ë“œ( .class íŒŒì¼ )ë¥¼ -> OSì— íŠ¹í™”ëœ ì½”ë“œë¡œ ë³€í™˜í•˜ì—¬ ì‹¤í–‰**í•œë‹¤.
	- ì¸í„°í”„ë¦¬í„°ì™€ JIT ì»´íŒŒì¼ëŸ¬ê°€ Native OS(mac, windows,...)ì— ë§ê²Œ ë¨¸ì‹ ì½”ë“œë¡œ ë³€í™˜í•˜ì—¬ ì‹¤í–‰í•¨
	- ì˜ˆë¥¼ ë“¤ì–´, Hello.class í´ë˜ìŠ¤ íŒŒì¼ë§Œ ìˆìœ¼ë©´ ëª…ë ¹ì–´ë¡œ `java Hello`ì„ ì³ì„œ í•´ë‹¹ í´ë˜ìŠ¤ íŒŒì¼ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ 
	- ![](../img/Pasted%20image%2020221018195341.png)
- JVMì´ í•˜ëŠ” ì¼
	- í´ë˜ìŠ¤ ì½ê¸°, ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ê¸°, OSì— ë§ëŠ” ë¨¸ì‹  ì½”ë“œë¡œ ë³€í™˜í•´ì„œ ì‹¤í–‰í•˜ê¸°, ...
- JVM ìŠ¤íŒ© : https://docs.oracle.com/javase/specs/jvms/se11/html/
- JVM ë°´ë” : ì˜¤ë¼í´, ì•„ë§ˆì¡´, Azul, ...
	- JVM ìŠ¤íŒ©ì— ë§ì¶° ë‹¤ì–‘í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
- íŠ¹ì • **í”Œë«í¼ì— ì¢…ì†ì **ì´ë‹¤.
	- ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ë°”ê¿”ì„œ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ë° ì´ê²Œ OSì— ë§ê²Œ ë³€í™˜í•´ì•¼ í•˜ë¯€ë¡œ...

### JRE (Java Runtime Environment) : JVM + ë¼ì´ë¸ŒëŸ¬ë¦¬
- `ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰`í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±ëœ ë°°í¬íŒ. ( ìµœì†Œí•œì˜ ë°°í¬ë‹¨ìœ„ë¡œ ì‹¤í–‰ì— í•„ìš”í•œ ê²ƒë§Œ ë“¤ì–´ìˆë‹¤ )
	- JVMì´ ë‹¨ë…ìœ¼ë¡œ ì œê³µë˜ì§€ ì•ŠëŠ”ë‹¤.
- JVMê³¼ í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ìë°” ëŸ°íƒ€ì„ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œí¼í‹° ì…‹íŒ…ì´ë‚˜ ë¦¬ì†ŒìŠ¤ íŒŒì¼ì„ ê°€ì§€ê³  ìˆë‹¤.
- ê°œë°œì— í•„ìš”í•œ íˆ´ì€ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤ -> ê·¸ê±´ JDKì—ì„œ ì œê³µí•œë‹¤
	- javac ì»´íŒŒì¼ëŸ¬ëŠ” ì—†ë‹¤. ê·¸ë˜ì„œ JREë§Œìœ¼ë¡œ classíŒŒì¼ì„ ì‹¤í–‰í•  ìˆ˜ëŠ” ìˆì§€ë§Œ classíŒŒì¼ë¡œ ì»´íŒŒì¼ í•  ìˆ˜ëŠ” ì—†ë‹¤. 


### JDK (Java Development Kit) : JRE + ê°œë°œ íˆ´
- JVM < JRE < JDK
- ì†ŒìŠ¤ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ìë°” ì–¸ì–´ëŠ” í”Œë«í¼ì— ë…ë¦½ì 
	- Write Once Run Anywhere
- ì˜¤ë¼í´ì€ ìë°” 11ë¶€í„°ëŠ” JDKë§Œ ì œê³µí•˜ë©° JREëŠ” ë”°ë¡œ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤
	- ì˜ˆì „ì—ëŠ” ë²„ì „ë³„ë¡œ JREì™€ JDK ë°°í¬íŒì„ ë‘ ê°œì”© ì œê³µí–ˆë‹¤.
	- ìë°” 9ë¶€í„° java module systemì´ ë“¤ì–´ì™”ë‹¤. ì´ë¥¼ ê°€ì§€ê³  ë‚˜ë§Œì˜ ì‘ì€ JREê°™ì€ jlinkë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤


### ìë°”
- í”„ë¡œê·¸ë˜ë° ì–¸ì–´
- JDKì— ë“¤ì–´ìˆëŠ” ìë°” ì»´íŒŒì¼ëŸ¬ (javac)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°”ì´íŠ¸ì½”ë“œ(.class)ë¡œ ì»´íŒŒì¼ í•  ìˆ˜ ìˆë‹¤. 
	- ìë°” ì»´íŒŒì¼ëŸ¬(`javac Hello.java`) : ìë°” ì½”ë“œ -> ë°”ì´íŠ¸ ì½”ë“œ (.class)
	- ì¸í„°í”„ë¦¬í„°ì™€ JIT(`java Hello`) : ë°”ì´íŠ¸ ì½”ë“œ (.class) -> OS íŠ¹í™” ì½”ë“œ
- ìë°” ìœ ë£Œí™”
	- ì˜¤ë¼í´ì—ì„œ ë§Œë“  `Oracle JDK 11 ë²„ì „`ë¶€í„° ìƒìš©ìœ¼ë¡œ ì‚¬ìš©í•  ë•Œ ìœ ë£Œ
	- ì˜¤ë¼í´ì—ì„œ ë§Œë“  Open JDKë‚˜ ë‹¤ë¥¸ ë°´ë”ì—ì„œ ë§Œë“  JDKëŠ” ë¬´ë£Œ


### JVM ì–¸ì–´
- JVM ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´
	- JVMì€ ì‚¬ì‹¤ìƒ classíŒŒì¼ë§Œ ìˆìœ¼ë©´ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— JAVAì™€ì˜ ì˜ì¡´ì„±ì´ ê°•í•˜ì§€ ì•Šë‹¤. 
	- ë”°ë¼ì„œ ë‹¤ë¥¸ ì–¸ì–´ì¼ì§€ë¼ë„ ì–´ë–¤ íŒŒì¼ì„ `ì»´íŒŒì¼í–ˆì„ ë•Œ classíŒŒì¼ì´ë‚˜ java íŒŒì¼ë§Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ë©´` JVMì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.
- í´ë¡œì €, ê·¸ë£¨ë¹„, JRuby, Jython, Kotlin, Scala, ...
	- ì½”í‹€ë¦° íŒŒì¼ì„ jarë¡œ íŒ¨í‚¤ì§•í•´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ : `kotlinc Hello.kt -include-runtime -d hello.jar`


## 2. JVM êµ¬ì¡°
í¬ê²Œ ë„¤ ê°€ì§€ ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬ì„±ë¨( í´ë˜ìŠ¤ ë¡œë” ì‹œìŠ¤í…œ, ë©”ëª¨ë¦¬, ì‹¤í–‰ ì—”ì§„, JNIì™€ ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬)

### [í´ë˜ìŠ¤ ë¡œë” ì‹œìŠ¤í…œ](í´ë˜ìŠ¤%20ë¡œë”%20ì‹œìŠ¤í…œ.md)
- ì»´íŒŒì¼ëœ .class ì—ì„œ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì½ê³  ë©”ëª¨ë¦¬ì— ì ì ˆíˆ ë°°ì¹˜í•˜ì—¬ ì €ì¥
	![|450](Pasted%20image%2020221019063929.png)
	- ë°”ì´íŠ¸ ì½”ë“œë¥¼ javap ê°™ì€ ê²ƒì„ ì‚¬ìš©í•´ ë””ì»´íŒŒì¼í•´ì„œ ì¢€ ë” ì‚¬ëŒì´ ë³´ê¸° í¸í•˜ë„ë¡ ë³´ì—¬ì¤€ë‹¤.
- í´ë˜ìŠ¤ ë¡œë”ê°€ í•˜ëŠ” ì¼
	- 1. ë¡œë”©(loading) : í´ë˜ìŠ¤ íŒŒì¼ì—ì„œ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì½ì–´ì˜¤ëŠ” ê³¼ì •
	- 2. ë§í¬(linking) : ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì—°ê²°í•˜ëŠ” ê³¼ì •
	- 3. ì´ˆê¸°í™”(initialization) : static ê°’ë“¤ ì´ˆê¸°í™” ë° ë³€ìˆ˜ì— í• ë‹¹
- í´ë˜ìŠ¤ì— static ê°’ìœ¼ë¡œ í• ë‹¹í•˜ë©´ ë‹¤ë¥¸ ê³³ì—ì„œë„ `í´ë˜ìŠ¤.XXX`ìœ¼ë¡œ ë°”ë¡œ ì ‘ê·¼í•´ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤ 
	```java
	public class ClassLoaderApp {  
	  
	    /**  
	     * static ê°’ í• ë‹¹  
	     */  
	    static String myName;  
	  
	    // static block  
	    static{  
	        myName = "grey";  
	    }  
	  
	    public static void main ( String[] args ) {  
	        System.out.println( ClassLoaderApp.class.getClassLoader() );  
	        System.out.println( List.class.getClassLoader() );  
	        System.out.println( myName );  
	    }  
	}
	```
	ì´ë ‡ê²Œ A í´ë˜ìŠ¤ì—ì„œ static ê°’ì„ í• ë‹¹í•˜ê³  
	```java
	public class ClassLoaderApp2{  
  
	    public static void main ( String[] args ) {  
	        System.out.println( ClassLoaderApp.myName );  
	    }  
	  
	}
	>> grey
	```
	B í´ë˜ìŠ¤ì—ì„œ ë°”ë¡œ ì“¸ ìˆ˜ ìˆë‹¤.


### ë©”ëª¨ë¦¬
í™ê³¼ ë©”ì†Œë“œ ì˜ì—­ë§Œ ëª¨ë“  ì˜ì—­ì— ê³µìœ í•˜ëŠ” ìì›ì´ê³  ë‚˜ë¨¸ì§€ëŠ” ì‹¤í–‰í•  ë•Œ ì“°ë ˆë“œë§ˆë‹¤ ìƒê¸°ê³  ê·¸ ì“°ë ˆë“œì—ì„œë§Œ ê³µìœ í•œë‹¤.

- **ğŸŒŸ ë©”ì†Œë“œ ì˜ì—­**: í´ë˜ìŠ¤ ìˆ˜ì¤€ì˜ ì •ë³´ë¥¼ ì €ì¥. ê³µìœ  ìì›ì´ë‹¤. 
	- í´ë˜ìŠ¤ ìˆ˜ì¤€ì˜ ì •ë³´ : í´ë˜ìŠ¤ ì´ë¦„, ë¶€ëª¨ í´ë˜ìŠ¤ ì´ë¦„, ë©”ì†Œë“œ, ë³€ìˆ˜ 
- **í™ ì˜ì—­**: ê°ì²´ë¥¼ ì €ì¥. ê³µìœ  ìì›ì´ë‹¤. 
---
- **ìŠ¤íƒ ì˜ì—­**: ì“°ë ˆë“œë§ˆë‹¤ ëŸ°íƒ€ì„ ìŠ¤íƒì„ ë§Œë“¤ê³ , ê·¸ ì•ˆì— ë©”ì†Œë“œ í˜¸ì¶œì„ `ìŠ¤íƒ í”„ë ˆì„(ë©”ì„œë“œ ì½œ)`ì´ë¼ ë¶€ë¥´ëŠ” ë¸”ëŸ­ìœ¼ë¡œ ìŒ“ëŠ”ë‹¤. ì“°ë ˆë“œ ì¢…ë£Œí•˜ë©´ ëŸ°íƒ€ì„ ìŠ¤íƒë„ ì‚¬ë¼ì§„ë‹¤. 
	- ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ë©´ ì½œ ìŠ¤íƒì´ ì­‰- ìŒ“ì¸ê²Œ ë³´ì¸ë‹¤ 
- **PC (Program Counter) ë ˆì§€ìŠ¤í„°**: ì“°ë ˆë“œë§ˆë‹¤ ì“°ë ˆë“œ ë‚´ í˜„ì¬ ì‹¤í–‰í•  instructionì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°ê°€ ìƒì„±ëœë‹¤.
- **ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ìŠ¤íƒ**
	- ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ í˜¸ì¶œí• ë•Œ ì‚¬ìš©í•˜ëŠ” ë³„ë„ì˜ ë©”ì†Œë“œ ìŠ¤íƒ
	- [https://javapapers.com/core-java/java-jvm-run-time-data-areas/#Program_Counter_PC_Register](https://javapapers.com/core-java/java-jvm-run-time-data-areas/#Program_Counter_PC_Register)

```ad-note
- ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ: ë©”ì†Œë“œì— `native` í‚¤ì›Œë“œê°€ ë¶™ì–´ìˆê³ , ê·¸ êµ¬í˜„ì„ ìë°”ê°€ ì•„ë‹Œ Cë‚˜ C++ë¡œ êµ¬í˜„í•œ ê²ƒ
- ì˜ˆë¥¼ ë“¤ì–´, Thread.currentThread();ëŠ” Cë¡œ êµ¬í˜„ë˜ì–´ ìˆë‹¤. 
- ![](Pasted%20image%2020221019071421.png)
```

### ì‹¤í–‰ ì—”ì§„
- ì¸í„°í”„ë¦¬í„°: ë°”ì´íŠ¸ ì½”ë“œë¥¼ í•œ ì¤„ì”© ì‹¤í–‰
- JIT ì»´íŒŒì¼ëŸ¬: ì¸í„°í”„ë¦¬í„°ì˜ íš¨ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´, ì¸í„°í”„ë¦¬í„°ê°€ `ë°˜ë³µë˜ëŠ” ì½”ë“œ`ë¥¼ ë°œê²¬í•˜ë©´ JIT ì»´íŒŒì¼ëŸ¬ë¡œ `ë°˜ë³µë˜ëŠ” ë°”ì´íŠ¸ ì½”ë“œë¥¼ ëª¨ë‘ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ë°”ê¿”ë‘”ë‹¤.` ê·¸ ë‹¤ìŒë¶€í„° ì¸í„°í”„ë¦¬í„°ëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ë°”ë¡œ ì‚¬ìš©í•œë‹¤. 
- GC (Garbage Collector): ë” ì´ìƒ ì°¸ì¡°ë˜ì§€ ì•ŠëŠ” ê°ì²´ë“¤ì„ ëª¨ì•„ì„œ ì •ë¦¬í•œë‹¤.
	- 1. ì“°ë¡œìš°í’‹ ìœ„ì£¼ì˜ GC
	- 2. Stop The Worldë¥¼ ì¤„ì´ëŠ” GC
		- ë§ì€ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , response timeì„ ì¤„ì´ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤ë©´ => GCë¥¼ í•  ë•Œ ë°œìƒí•˜ëŠ” ë©ˆì¶¤ í˜„ìƒ(Stop The World)ì„ ìµœì†Œí™”í•  ìˆ˜ ìˆëŠ” GCë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.

### JNI (Java Native Interface)
- ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ C, C++, ì–´ì…ˆë¸”ë¦¬ì–´ë¡œ ì‘ì„±ëœ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µ
- native í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ë©”ì†Œë“œ í˜¸ì¶œ
- ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ì½”ë“œ ì¤‘ì— native í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œê°€ ìˆë‹¤?
	- ê·¸ëŸ¼ ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ìŠ¤íƒì´ ìƒê¸°ê³  -> JNIë¥¼ í˜¸ì¶œí•˜ëŠ” ìŠ¤íƒí”„ë ˆì„ì´ í•˜ë‚˜ ìŒ“ì¸ë‹¤
- [https://medium.com/@bschlining/a-simple-java-native-interface-jni-example-in-java-and-scala-68fdafe76f5f](https://medium.com/@bschlining/a-simple-java-native-interface-jni-example-in-java-and-scala-68fdafe76f5f)

### ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- C, C++ë¡œ ì‘ì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬. JNIë¥¼ êµ¬í˜„í•œ ìì²´ë¥¼ ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ í•œë‹¤
- ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ë ¤ë©´ JNIë¥¼ í†µí•´ì•¼ í•œë‹¤. JNIë¥¼ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œ ìŠ¤íƒì€ ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ìŠ¤íƒì— ì €ì¥ëœë‹¤. 


## 3. í´ë˜ìŠ¤ ë¡œë” 



# ì¶œì²˜(ì°¸ê³ ë¬¸í—Œ)
- "ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•"
	-   JIT ì»´íŒŒì¼ëŸ¬: [https://aboullaite.me/understanding-jit-compiler-just-in-time-compiler/](https://aboullaite.me/understanding-jit-compiler-just-in-time-compiler/)
	-   JDK, JRE ê·¸ë¦¬ê³  JVM: [https://howtodoinjava.com/java/basics/jdk-jre-jvm/](https://howtodoinjava.com/java/basics/jdk-jre-jvm/)
	-   [https://en.wikipedia.org/wiki/List_of_JVM_languages](https://en.wikipedia.org/wiki/List_of_JVM_languages)
	-   [https://www.geeksforgeeks.org/jvm-works-jvm-architecture/](https://www.geeksforgeeks.org/jvm-works-jvm-architecture/)
	-   [https://dzone.com/articles/jvm-architecture-explained](https://dzone.com/articles/jvm-architecture-explained)
	-   [http://blog.jamesdbloom.com/JVMInternals.html](http://blog.jamesdbloom.com/JVMInternals.html)



# ì—°ê²°ë¬¸ì„œ
- 
